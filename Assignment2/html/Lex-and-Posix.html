<html lang="en">
<head>
<title>Lex and Posix - Lexical Analysis With Flex</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Lexical Analysis With Flex">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="prev" href="Reentrant.html#Reentrant" title="Reentrant">
<link rel="next" href="Memory-Management.html#Memory-Management" title="Memory Management">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
The flex manual is placed under the same licensing conditions as the
rest of flex:

Copyright (C) 2001, 2002, 2003, 2004, 2005, 2006, 2007 The Flex
Project.

Copyright (C) 1990, 1997 The Regents of the University of California.
All rights reserved.

This code is derived from software contributed to Berkeley by
Vern Paxson.

The United States Government has rights in this work pursuant
to contract no. DE-AC03-76SF00098 between the United States
Department of Energy and the University of California.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
  1.  Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.

  2. Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in the
     documentation and/or other materials provided with the
     distribution.

Neither the name of the University nor the names of its contributors
may be used to endorse or promote products derived from this software
without specific prior written permission.

THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Lex-and-Posix"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Memory-Management.html#Memory-Management">Memory Management</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Reentrant.html#Reentrant">Reentrant</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="index.html#Top">Top</a>
<hr>
</div>

<h2 class="chapter">20 Incompatibilities with Lex and Posix</h2>

<p><a name="index-POSIX-and-lex-447"></a><a name="index-lex-_0028traditional_0029-and-POSIX-448"></a>
<code>flex</code> is a rewrite of the AT&amp;T Unix <em>lex</em> tool (the two
implementations do not share any code, though), with some extensions and
incompatibilities, both of which are of concern to those who wish to
write scanners acceptable to both implementations.  <code>flex</code> is fully
compliant with the POSIX <code>lex</code> specification, except that when
using <code>%pointer</code> (the default), a call to <code>unput()</code> destroys
the contents of <code>yytext</code>, which is counter to the POSIX
specification.  In this section we discuss all of the known areas of
incompatibility between <code>flex</code>, AT&amp;T <code>lex</code>, and the POSIX
specification.  <code>flex</code>'s &lsquo;<samp><span class="samp">-l</span></samp>&rsquo; option turns on maximum
compatibility with the original AT&amp;T <code>lex</code> implementation, at the
cost of a major loss in the generated scanner's performance.  We note
below which incompatibilities can be overcome using the &lsquo;<samp><span class="samp">-l</span></samp>&rsquo;
option.  <code>flex</code> is fully compatible with <code>lex</code> with the
following exceptions:

     <ul>
<li>The undocumented <code>lex</code> scanner internal variable <code>yylineno</code> is
not supported unless &lsquo;<samp><span class="samp">-l</span></samp>&rsquo; or <code>%option yylineno</code> is used.

     <li><code>yylineno</code> should be maintained on a per-buffer basis, rather than
a per-scanner (single global variable) basis.

     <li><code>yylineno</code> is not part of the POSIX specification.

     <li>The <code>input()</code> routine is not redefinable, though it may be called
to read characters following whatever has been matched by a rule.  If
<code>input()</code> encounters an end-of-file the normal <code>yywrap()</code>
processing is done.  A &ldquo;real&rdquo; end-of-file is returned by
<code>input()</code> as <code>EOF</code>.

     <li>Input is instead controlled by defining the <code>YY_INPUT()</code> macro.

     <li>The <code>flex</code> restriction that <code>input()</code> cannot be redefined is
in accordance with the POSIX specification, which simply does not
specify any way of controlling the scanner's input other than by making
an initial assignment to <samp><span class="file">yyin</span></samp>.

     <li>The <code>unput()</code> routine is not redefinable.  This restriction is in
accordance with POSIX.

     <li><code>flex</code> scanners are not as reentrant as <code>lex</code> scanners.  In
particular, if you have an interactive scanner and an interrupt handler
which long-jumps out of the scanner, and the scanner is subsequently
called again, you may get the following message:

     <p><a name="index-error-messages_002c-end-of-buffer-missed-449"></a>
     <pre class="example">     <pre class="verbatim">              fatal @code{flex} scanner internal error--end of buffer missed
     </pre>
</pre>
     <p>To reenter the scanner, first use:

     <p><a name="index-restarting-the-scanner-450"></a>
     <pre class="example">     <pre class="verbatim">              yyrestart( yyin );
     </pre>
</pre>
     <p>Note that this call will throw away any buffered input; usually this
isn't a problem with an interactive scanner. See <a href="Reentrant.html#Reentrant">Reentrant</a>, for
<code>flex</code>'s reentrant API.

     <li>Also note that <code>flex</code> C++ scanner classes
<em>are</em>
reentrant, so if using C++ is an option for you, you should use
them instead.  See <a href="Cxx.html#Cxx">Cxx</a>, and <a href="Reentrant.html#Reentrant">Reentrant</a>  for details.

     <li><code>output()</code> is not supported.  Output from the <b>ECHO</b> macro is
done to the file-pointer <code>yyout</code> (default <samp><span class="file">stdout)</span></samp>.

     <li><code>output()</code> is not part of the POSIX specification.

     <li><code>lex</code> does not support exclusive start conditions (%x), though they
are in the POSIX specification.

     <li>When definitions are expanded, <code>flex</code> encloses them in parentheses. 
With <code>lex</code>, the following:

     <p><a name="index-name-definitions_002c-not-POSIX-451"></a>
     <pre class="example">     <pre class="verbatim">              NAME    [A-Z][A-Z0-9]*
              %%
              foo{NAME}?      printf( "Found it\n" );
              %%
     </pre>
</pre>
     <p>will not match the string &lsquo;<samp><span class="samp">foo</span></samp>&rsquo; because when the macro is expanded
the rule is equivalent to &lsquo;<samp><span class="samp">foo[A-Z][A-Z0-9]*?</span></samp>&rsquo;  and the precedence
is such that the &lsquo;<samp><span class="samp">?</span></samp>&rsquo; is associated with &lsquo;<samp><span class="samp">[A-Z0-9]*</span></samp>&rsquo;.  With
<code>flex</code>, the rule will be expanded to &lsquo;<samp><span class="samp">foo([A-Z][A-Z0-9]*)?</span></samp>&rsquo;
and so the string &lsquo;<samp><span class="samp">foo</span></samp>&rsquo; will match.

     <li>Note that if the definition begins with &lsquo;<samp><span class="samp">^</span></samp>&rsquo; or ends with &lsquo;<samp><span class="samp">$</span></samp>&rsquo;
then it is <em>not</em> expanded with parentheses, to allow these
operators to appear in definitions without losing their special
meanings.  But the &lsquo;<samp><span class="samp">&lt;s&gt;</span></samp>&rsquo;, &lsquo;<samp><span class="samp">/</span></samp>&rsquo;, and <code>&lt;&lt;EOF&gt;&gt;</code> operators
cannot be used in a <code>flex</code> definition.

     <li>Using &lsquo;<samp><span class="samp">-l</span></samp>&rsquo; results in the <code>lex</code> behavior of no parentheses
around the definition.

     <li>The POSIX specification is that the definition be enclosed in parentheses.

     <li>Some implementations of <code>lex</code> allow a rule's action to begin on a
separate line, if the rule's pattern has trailing whitespace:

     <p><a name="index-patterns-and-actions-on-different-lines-452"></a>
     <pre class="example">     <pre class="verbatim">              %%
              foo|bar&lt;space here>
                { foobar_action();}
     </pre>
</pre>
     <p><code>flex</code> does not support this feature.

     <li>The <code>lex</code> <code>%r</code> (generate a Ratfor scanner) option is not
supported.  It is not part of the POSIX specification.

     <li>After a call to <code>unput()</code>, <em>yytext</em> is undefined until the
next token is matched, unless the scanner was built using <code>%array</code>. 
This is not the case with <code>lex</code> or the POSIX specification.  The
&lsquo;<samp><span class="samp">-l</span></samp>&rsquo; option does away with this incompatibility.

     <li>The precedence of the &lsquo;<samp><span class="samp">{,}</span></samp>&rsquo; (numeric range) operator is
different.  The AT&amp;T and POSIX specifications of <code>lex</code>
interpret &lsquo;<samp><span class="samp">abc{1,3}</span></samp>&rsquo; as match one, two,
or three occurrences of &lsquo;<samp><span class="samp">abc</span></samp>&rsquo;&rdquo;, whereas <code>flex</code> interprets it
as &ldquo;match &lsquo;<samp><span class="samp">ab</span></samp>&rsquo; followed by one, two, or three occurrences of
&lsquo;<samp><span class="samp">c</span></samp>&rsquo;&rdquo;.  The &lsquo;<samp><span class="samp">-l</span></samp>&rsquo; and &lsquo;<samp><span class="samp">--posix</span></samp>&rsquo; options do away with this
incompatibility.

     <li>The precedence of the &lsquo;<samp><span class="samp">^</span></samp>&rsquo; operator is different.  <code>lex</code>
interprets &lsquo;<samp><span class="samp">^foo|bar</span></samp>&rsquo; as &ldquo;match either 'foo' at the beginning of a
line, or 'bar' anywhere&rdquo;, whereas <code>flex</code> interprets it as &ldquo;match
either &lsquo;<samp><span class="samp">foo</span></samp>&rsquo; or &lsquo;<samp><span class="samp">bar</span></samp>&rsquo; if they come at the beginning of a
line&rdquo;.  The latter is in agreement with the POSIX specification.

     <li>The special table-size declarations such as <code>%a</code> supported by
<code>lex</code> are not required by <code>flex</code> scanners..  <code>flex</code>
ignores them. 
<li>The name <code>FLEX_SCANNER</code> is <code>#define</code>'d so scanners may be
written for use with either <code>flex</code> or <code>lex</code>.  Scanners also
include <code>YY_FLEX_MAJOR_VERSION</code>,  <code>YY_FLEX_MINOR_VERSION</code>
and <code>YY_FLEX_SUBMINOR_VERSION</code>
indicating which version of <code>flex</code> generated the scanner. For
example, for the 2.5.22 release, these defines would be 2,  5 and 22
respectively. If the version of <code>flex</code> being used is a beta
version, then the symbol <code>FLEX_BETA</code> is defined.

     <li>The symbols &lsquo;<samp><span class="samp">[[</span></samp>&rsquo; and &lsquo;<samp><span class="samp">]]</span></samp>&rsquo; in the code sections of the input
may conflict with the m4 delimiters. See <a href="M4-Dependency.html#M4-Dependency">M4 Dependency</a>.

   </ul>

   <p><a name="index-POSIX-comp_003bcompliance-453"></a><a name="index-non_002dPOSIX-features-of-flex-454"></a>The following <code>flex</code> features are not included in <code>lex</code> or the
POSIX specification:

     <ul>
<li>C++ scanners
<li>%option
<li>start condition scopes
<li>start condition stacks
<li>interactive/non-interactive scanners
<li>yy_scan_string() and friends
<li>yyterminate()
<li>yy_set_interactive()
<li>yy_set_bol()
<li>YY_AT_BOL()
   &lt;&lt;EOF&gt;&gt;
<li>&lt;*&gt;
<li>YY_DECL
<li>YY_START
<li>YY_USER_ACTION
<li>YY_USER_INIT
<li>#line directives
<li>%{}'s around actions
<li>reentrant C API
<li>multiple actions on a line
<li>almost all of the <code>flex</code> command-line options
</ul>

   <p>The feature &ldquo;multiple actions on a line&rdquo;
refers to the fact that with <code>flex</code> you can put multiple actions on
the same line, separated with semi-colons, while with <code>lex</code>, the
following:

<pre class="example"><pre class="verbatim">         foo    handle_foo(); ++num_foos_seen;
</pre>
</pre>
   <p>is (rather surprisingly) truncated to

<pre class="example"><pre class="verbatim">         foo    handle_foo();
</pre>
</pre>
   <p><code>flex</code> does not truncate the action.  Actions that are not enclosed
in braces are simply terminated at the end of the line.

   </body></html>

