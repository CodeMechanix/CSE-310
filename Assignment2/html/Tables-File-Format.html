<html lang="en">
<head>
<title>Tables File Format - Lexical Analysis With Flex</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Lexical Analysis With Flex">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Serialized-Tables.html#Serialized-Tables" title="Serialized Tables">
<link rel="prev" href="Loading-and-Unloading-Serialized-Tables.html#Loading-and-Unloading-Serialized-Tables" title="Loading and Unloading Serialized Tables">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
The flex manual is placed under the same licensing conditions as the
rest of flex:

Copyright (C) 2001, 2002, 2003, 2004, 2005, 2006, 2007 The Flex
Project.

Copyright (C) 1990, 1997 The Regents of the University of California.
All rights reserved.

This code is derived from software contributed to Berkeley by
Vern Paxson.

The United States Government has rights in this work pursuant
to contract no. DE-AC03-76SF00098 between the United States
Department of Energy and the University of California.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
  1.  Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.

  2. Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in the
     documentation and/or other materials provided with the
     distribution.

Neither the name of the University nor the names of its contributors
may be used to endorse or promote products derived from this software
without specific prior written permission.

THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Tables-File-Format"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Loading-and-Unloading-Serialized-Tables.html#Loading-and-Unloading-Serialized-Tables">Loading and Unloading Serialized Tables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Serialized-Tables.html#Serialized-Tables">Serialized Tables</a>
<hr>
</div>

<h3 class="section">22.3 Tables File Format</h3>

<p><a name="index-tables_002c-file-format-474"></a><a name="index-file-format_002c-serialized-tables-475"></a>
This section defines the file format of serialized <code>flex</code> tables.

   <p>The tables format allows for one or more sets of tables to be
specified, where each set corresponds to a given scanner. Scanners are
indexed by name, as described below. The file format is as follows:

<pre class="example"><pre class="verbatim">                      TABLE SET 1
                     +-------------------------------+
             Header  | uint32          th_magic;     |
                     | uint32          th_hsize;     |
                     | uint32          th_ssize;     |
                     | uint16          th_flags;     |
                     | char            th_version[]; |
                     | char            th_name[];    |
                     | uint8           th_pad64[];   |
                     +-------------------------------+
             Table 1 | uint16          td_id;        |
                     | uint16          td_flags;     |
                     | uint32          td_lolen;     |
                     | uint32          td_hilen;     |
                     | void            td_data[];    |
                     | uint8           td_pad64[];   |
                     +-------------------------------+
             Table 2 |                               |
                .    .                               .
                .    .                               .
                .    .                               .
                .    .                               .
             Table n |                               |
                     +-------------------------------+
                      TABLE SET 2
                           .
                           .
                           .
                      TABLE SET N
</pre>
</pre>
   <p>The above diagram shows that a complete set of tables consists of a header
followed by multiple individual tables. Furthermore, multiple complete sets may
be present in the same file, each set with its own header and tables. The sets
are contiguous in the file. The only way to know if another set follows is to
check the next four bytes for the magic number (or check for EOF). The header
and tables sections are padded to 64-bit boundaries. Below we describe each
field in detail. This format does not specify how the scanner will expand the
given data, i.e., data may be serialized as int8, but expanded to an int32
array at runtime. This is to reduce the size of the serialized data where
possible.  Remember, <em>all integer values are in network byte order</em>.

<p class="noindent">Fields of a table header:

     <dl>
<dt><code>th_magic</code><dd>Magic number, always 0xF13C57B1.

     <br><dt><code>th_hsize</code><dd>Size of this entire header, in bytes, including all fields plus any padding.

     <br><dt><code>th_ssize</code><dd>Size of this entire set, in bytes, including the header, all tables, plus
any padding.

     <br><dt><code>th_flags</code><dd>Bit flags for this table set. Currently unused.

     <br><dt><code>th_version[]</code><dd>Flex version in NULL-terminated string format. e.g., &lsquo;<samp><span class="samp">2.5.13a</span></samp>&rsquo;. This is
the version of flex that was used to create the serialized tables.

     <br><dt><code>th_name[]</code><dd>Contains the name of this table set. The default is &lsquo;<samp><span class="samp">yytables</span></samp>&rsquo;,
and is prefixed accordingly, e.g., &lsquo;<samp><span class="samp">footables</span></samp>&rsquo;. Must be NULL-terminated.

     <br><dt><code>th_pad64[]</code><dd>Zero or more NULL bytes, padding the entire header to the next 64-bit boundary
as calculated from the beginning of the header. 
</dl>

<p class="noindent">Fields of a table:

     <dl>
<dt><code>td_id</code><dd>Specifies the table identifier. Possible values are:
          <dl>
<dt><code>YYTD_ID_ACCEPT (0x01)</code><dd><code>yy_accept</code>
<br><dt><code>YYTD_ID_BASE   (0x02)</code><dd><code>yy_base</code>
<br><dt><code>YYTD_ID_CHK    (0x03)</code><dd><code>yy_chk</code>
<br><dt><code>YYTD_ID_DEF    (0x04)</code><dd><code>yy_def</code>
<br><dt><code>YYTD_ID_EC     (0x05)</code><dd><code>yy_ec </code>
<br><dt><code>YYTD_ID_META   (0x06)</code><dd><code>yy_meta</code>
<br><dt><code>YYTD_ID_NUL_TRANS (0x07)</code><dd><code>yy_NUL_trans</code>
<br><dt><code>YYTD_ID_NXT (0x08)</code><dd><code>yy_nxt</code>. This array may be two dimensional. See the <code>td_hilen</code>
field below. 
<br><dt><code>YYTD_ID_RULE_CAN_MATCH_EOL (0x09)</code><dd><code>yy_rule_can_match_eol</code>
<br><dt><code>YYTD_ID_START_STATE_LIST (0x0A)</code><dd><code>yy_start_state_list</code>. This array is handled specially because it is an
array of pointers to structs. See the <code>td_flags</code> field below. 
<br><dt><code>YYTD_ID_TRANSITION (0x0B)</code><dd><code>yy_transition</code>. This array is handled specially because it is an array of
structs. See the <code>td_lolen</code> field below. 
<br><dt><code>YYTD_ID_ACCLIST (0x0C)</code><dd><code>yy_acclist</code>
</dl>

     <br><dt><code>td_flags</code><dd>Bit flags describing how to interpret the data in <code>td_data</code>. 
The data arrays are one-dimensional by default, but may be
two dimensional as specified in the <code>td_hilen</code> field.

          <dl>
<dt><code>YYTD_DATA8 (0x01)</code><dd>The data is serialized as an array of type int8. 
<br><dt><code>YYTD_DATA16 (0x02)</code><dd>The data is serialized as an array of type int16. 
<br><dt><code>YYTD_DATA32 (0x04)</code><dd>The data is serialized as an array of type int32. 
<br><dt><code>YYTD_PTRANS (0x08)</code><dd>The data is a list of indexes of entries in the expanded <code>yy_transition</code>
array.  Each index should be expanded to a pointer to the corresponding entry
in the <code>yy_transition</code> array. We count on the fact that the
<code>yy_transition</code> array has already been seen. 
<br><dt><code>YYTD_STRUCT (0x10)</code><dd>The data is a list of yy_trans_info structs, each of which consists of
two integers. There is no padding between struct elements or between structs. 
The type of each member is determined by the <code>YYTD_DATA*</code> bits. 
</dl>

     <br><dt><code>td_lolen</code><dd>Specifies the number of elements in the lowest dimension array. If this is
a one-dimensional array, then it is simply the number of elements in this array. 
The element size is determined by the <code>td_flags</code> field.

     <br><dt><code>td_hilen</code><dd>If <code>td_hilen</code> is non-zero, then the data is a two-dimensional array. 
Otherwise, the data is a one-dimensional array. <code>td_hilen</code> contains the
number of elements in the higher dimensional array, and <code>td_lolen</code> contains
the number of elements in the lowest dimension.

     <p>Conceptually, <code>td_data</code> is either <code>sometype td_data[td_lolen]</code>, or
<code>sometype td_data[td_hilen][td_lolen]</code>, where <code>sometype</code> is specified
by the <code>td_flags</code> field.  It is possible for both <code>td_lolen</code> and
<code>td_hilen</code> to be zero, in which case <code>td_data</code> is a zero length
array, and no data is loaded, i.e., this table is simply skipped. Flex does not
currently generate tables of zero length.

     <br><dt><code>td_data[]</code><dd>The table data. This array may be a one- or two-dimensional array, of type
<code>int8</code>, <code>int16</code>, <code>int32</code>, <code>struct yy_trans_info</code>, or
<code>struct yy_trans_info*</code>,  depending upon the values in the
<code>td_flags</code>, <code>td_lolen</code>, and <code>td_hilen</code> fields.

     <br><dt><code>td_pad64[]</code><dd>Zero or more NULL bytes, padding the entire table to the next 64-bit boundary as
calculated from the beginning of this table. 
</dl>

   </body></html>

